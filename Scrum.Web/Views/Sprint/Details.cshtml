
@model Scrum.Dominio.Models.Sprint

@{
    ViewBag.Title = "Detalhe sprint - Scrum";
}
<script src="~/Views/Shared/BurnDown.js" type="text/javascript"></script>
    <h2 class="text-center">Detalhe sprint: @Model.titulo</h2>

    <div class="slide-left panel panel-info">
        <div class="panel-heading">
            <i class="fa fa-info fa-fw"></i> @Model.titulo
        </div>
        <div class="panel-body">

            <div class="col-xs-12">
                <div class="panel panel-success">
                   <div class="panel-heading">
                       <a class="btn btn-xs col-xs-12" id="getBurnDown" role="button" data-toggle="collapse" href="#SprintBurnDown" aria-expanded="false" aria-controls="#SprintBurnDown">
                           <i class="glyphicon glyphicon-eye-open">
                               BurnDown
                           </i>
                       </a>                       
                    </div>
                    <div class="panel-body collapse" id="SprintBurnDown">
                        <div style="width:100%; height:450px">
                            <div>
                                <canvas id="burnDownSprint" style="height:450px; width:auto;"></canvas>
                            </div>
                        </div>
                        <script>
                            $('#getBurnDown').click(function () {
                                $.ajax({
                                    url: "/BurnDown/BuscarSprintId/",
                                    type: 'GET',
                                    dataType: 'json',
                                    data: { idSprint: @Model.id },
                                    success: function (data) {
                                        createBurnDown(data, "burnDownSprint");
                                    }
                                });});


                            function createBurnDown(burnDownSprint, elementId) {
                                var lineChartData = {
                                    labels: burnDownSprint.Legenda,
                                    datasets: [
                                        {
                                            label: "Desempenho",
                                            fillColor: "rgba(151,187,205,0.2)",
                                            strokeColor: "rgba(151,187,205,1)",
                                            pointColor: "rgba(151,187,205,1)",
                                            pointStrokeColor: "#fff",
                                            pointHighlightFill: "#fff",
                                            pointHighlightStroke: "rgba(220,220,220,1)",
                                            data: burnDownSprint.Desempenho
                                        },
                                        {
                                            label: "Meta Ideal",
                                            fillColor: "rgba(151,187,205,0.2)",
                                            strokeColor: "rgba(255, 0, 0, 1)",
                                            pointColor: "rgba(255, 0, 0, 1)",
                                            pointStrokeColor: "#fff",
                                            pointHighlightFill: "#fff",
                                            pointHighlightStroke: "rgba(255, 0, 0, 1)",
                                            data: burnDownSprint.Meta

                                        }
                                    ]

                                };

                                var ctx = document.getElementById(elementId).getContext("2d");
                                window.myLine = new Chart(ctx).Line(lineChartData, {
                                    responsive: true
                                });
                            }
                        </script>
                    </div>

                        </div>
                    </div>
        

                        @foreach (var estoria in Model.estorias)
                        {
                            <div class="col-xs-12 col-sm-6 col-lg-4">
                                <div class="panel panel-success">
                                    <div class="panel-heading">
                                        <div class="col-xs-12">
                                            <a class="btn btn-xs col-xs-12" role="button" data-toggle="collapse" href="#@estoria.id" aria-expanded="false" aria-controls="#@estoria.id">
                                                <i class="glyphicon glyphicon-eye-open">                                                    
                                                </i>
                                                @estoria.titulo
                                                <span class="badge">@estoria.GetQuantidadeConcluida()</span>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="panel-body collapse" id="@estoria.id">
                                        <ul class="media-list list-group">
                                            @foreach (var tarefa in estoria.tarefas)
                                            {
                                                <li class="media list-group-item">
                                                    <div class="row">
                                                    <div class="media-body col-xs-10">
                                                        @tarefa.titulo
                                                    </div>
                                                    <a class="col-xs-2 btn btn-xs" href="../../Tarefa/Edit/@tarefa.id">
                                                        <i class="glyphicon glyphicon-pencil"></i>
                                                    </a>
                                                    </div>
                                                    
                                                        @if (@tarefa.FoiConcluida())
                                                        {
                                                            <div class="row">
                                                                <div class="col-xs-2">
                                                                    <i class="glyphicon glyphicon-ok"></i>
                                                                </div>
                                                                <div class="media-left col-xs-10">
                                                                    @tarefa.membrotime.nome
                                                                </div>
                                                            </div>
                                                        }
                                                            

                                                </li>
                                            }
                                        </ul>
                                    </div>
                                    <div class="panel-footer">
                                        @estoria.descricao
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                <div class="panel-footer">
                    @Model.descricao
                </div>
            </div>

            <p>
                @Html.ActionLink("Editar", "Edit", new { id = Model.id }, new { @class = "btn btn-default", @title = "Editar sprint." })
                @Html.ActionLink("Voltar a lista", "Index", null, new { @class = "btn btn-default", @title = "Voltar a lista de sprints cadastradas." })
            </p>
